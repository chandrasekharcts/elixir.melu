{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Elixir Web | Create a Question</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="icon" href="{% static 'images/favicon.png'  %}" type="image/png">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}" media="screen"/>

</head>
<body>
<div class="main-container">
    <nav class="navbar navbar-expand justify-content-between fixed-top">
        <a class="navbar-brand mb-0 h1 d-none d-md-block" href="/dashboard/">
            <img src="{% static 'images/logo.png' %}" class="navbar-brand-image d-inline-block align-top mr-2" alt="">
            <small>Elixir <small>v3.0.1</small></small>
        </a>

        <a class="navbar-brand mb-0 h1 d-none d-md-block">
            <img src="{% static 'images/newcts.png' %}" class="pb-2">
        </a>

        <div class="d-flex flex-1 d-block d-md-none">
            <a href="#" class="sidebar-toggle ml-3">
                <i data-feather="menu"></i>
            </a>
        </div>

        <ul class="navbar-nav d-flex justify-content-end mr-2">
            <li class="sidebar-nav-item mt-1">
                <a class="sidebar-nav-link">
                  <span class="sidebar-nav-name">
                    <b style="font-family: Arial Rounded MT">{{ user.first_name }} {{ user.last_name }}</b>
                  </span>
                </a>
            </li>

            <li class="nav-item dropdown">
                <a class="nav-link avatar-with-name" id="navbarDropdownMenuLink" data-toggle="dropdown" href="#">
                    <img src="{% static 'images/user_icon.png' %}" class="d-inline-block align-top" alt="">
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                    {% if user.email != 'agent' %}
                    <a class="dropdown-item text-danger" href="/version_history/">Version History</a>
                    {% endif %}
                    <a class="dropdown-item text-danger" href="/account/logout/">Logout</a>
                </div>
            </li>
        </ul>
    </nav>

    <!-- expand-hover push -->
    <!-- Sidebar -->
    <div class="main-sidebar expand-hover push">
        <ul class="sidebar-nav">

            <!-- Dashboard -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="home"></i>
              </span>
                    <span class="sidebar-nav-name">
                Dashboard
              </span>
                    <span class="sidebar-nav-end">
              </span>
                </a>
            </li>

            <!-- Reporting -->
            {% if user.email != 'agent' %}
            <li class="sidebar-nav-item">
                <a href="/dashboard/reporting/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="airplay"></i>
              </span>
                    <span class="sidebar-nav-name">
                Reporting
              </span>
                    <span class="sidebar-nav-end">
              </span>
                </a>
            </li>
            {% endif %}

            <!-- My Task -->
            {% if user.email == 'agent' or user.email == 'superuser' %}
            <li class="sidebar-nav-item">
                <a class="sidebar-nav-link collapsed" data-toggle="collapse" href="#mytask" aria-expanded="false"
                   aria-controls="example">
                    <span class="sidebar-nav-icon">
                        <i data-feather="grid"></i>
                    </span>
                    <span class="sidebar-nav-name">
                        My Tasks
                    </span>
                    <span class="sidebar-nav-end">
                            <i data-feather="chevrons-right" class="nav-collapse-icon"></i>
                    </span>
                </a>

                <ul class="sidebar-sub-nav collapse" id="mytask">
                    <li class="sidebar-nav-item">
                        <a href="/dashboard/mytasks_up_kc/" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <i data-feather="server"></i>
                                <i data-feather="clipboard"></i>
                            </span>
                            <span class="sidebar-nav-name">
                            Update + Knowledge Test
                            </span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="/dashboard/mytasks_kc/" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <i data-feather="clipboard"></i>
                            </span>
                            <span class="sidebar-nav-name">
                                Knowledge Test
                            </span>
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}

            <!-- Knowledge Test Evaluation -->
            {% if user.email == 'poc' or user.email == 'superuser' %}
            <li class="sidebar-nav-item">
                <a href="/dashboard/knowledge-check-evaluation/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="file-text"></i>
              </span>
                    <span class="sidebar-nav-name">
                Knowledge Test Evaluation
              </span>
                    <span class="sidebar-nav-end">
              </span>
                </a>
            </li>
            {% endif %}

            <!-- Divider Start -->
            <li class="sidebar-nav-item">
                <div class="dropdown-divider ml-5 mr-5 mt-2 mb-2"></div>
            </li>
            <!-- Divider End -->

            <!-- Updates Repository -->
            {% if user.email != 'agent' %}
            <li class="sidebar-nav-item">
                <a href="/dashboard/elixir/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="server"></i>
              </span>
                    <span class="sidebar-nav-name">
                Updates Repository
              </span>
                    <span class="sidebar-nav-end">
              </span>
                </a>
            </li>
            {% endif %}

            {% if user.email == 'poc' or user.email == 'superuser' %}
            <!-- Create New Update -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/create-new-update/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="edit"></i>
              </span>
                    <span class="sidebar-nav-name">
                Create new Update
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- All Update -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/all-update/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="align-justify"></i>
              </span>
                    <span class="sidebar-nav-name">
                All Update
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Sent Update -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/sent-update/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="chevrons-up"></i>
              </span>
                    <span class="sidebar-nav-name">
                Sent Update
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Pending Update -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/pending-update/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="alert-circle"></i>
              </span>
                    <span class="sidebar-nav-name">
                Pending Update
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Acknowledged Update -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/acknowledged-update/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="check-circle"></i>
              </span>
                    <span class="sidebar-nav-name">
                Acknowledged Update
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Divider Start-->
            <li class="sidebar-nav-item">
                <div class="dropdown-divider ml-5 mr-5 mt-2 mb-2"></div>
            </li>
            <!-- Divider End-->
            {% endif %}


            {% if user.email != 'agent' %}
            <!-- Knowledge Test Repository -->
            <li class="sidebar-nav-item">

                <a href="/dashboard/conquest/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="clipboard"></i>
              </span>
                    <span class="sidebar-nav-name">
                Knowledge Test Repository
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Question Bank -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/question_bank/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="briefcase"></i>
              </span>
                    <span class="sidebar-nav-name">
                Question Bank
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>
            {% endif %}

            {% if user.email == 'poc' or user.email == 'superuser' %}
            <!-- Knowledge Test Result -->
            <li class="sidebar-nav-item">

                <a href="/dashboard/conquest_response/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="book"></i>
              </span>
                    <span class="sidebar-nav-name">
                Knowledge Test Result
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Create Knowledge Test -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/create-knowledge-check/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="file-plus"></i>
              </span>
                    <span class="sidebar-nav-name">
                Create Knowledge Test
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Create a Question -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/create-a-question/" class="sidebar-nav-link active">
              <span class="sidebar-nav-icon">
                <i data-feather="edit-3"></i>
              </span>
                    <span class="sidebar-nav-name">
                Create a Question
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- All Knowledge Test -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/all-knowledge-check/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="copy"></i>
              </span>
                    <span class="sidebar-nav-name">
                        All Knowledge Test <br><span style="font-size : 10px"> ( w/o update ) </span>
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Sent Knowledge Test-->
            <li class="sidebar-nav-item">
                <a href="/dashboard/sent-knowledge-check/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="arrow-up-right"></i>
              </span>
                    <span class="sidebar-nav-name">
                Sent Knowledge Test <br><span style="font-size : 10px"> ( w/o update ) </span>
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Pending Knowledge Test -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/pending-knowledge-check/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="alert-triangle"></i>
              </span>
                    <span class="sidebar-nav-name">
                Pending Knowledge Test <br><span style="font-size : 10px"> ( w/o update ) </span>
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Completed Knowledge Test -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/completed-knowledge-check/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="check-square"></i>
              </span>
                    <span class="sidebar-nav-name">
                Completed Knowledge Test <br><span style="font-size : 10px"> ( w/o update ) </span>
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Divider Start-->
            <li class="sidebar-nav-item">
                <div class="dropdown-divider ml-5 mr-5 mt-2 mb-2"></div>
            </li>
            <!-- Divider End-->
            {% endif %}

            {% if user.email == 'poc' or user.email == 'superuser' %}
            <!-- Update Source -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/update_source_type/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="cpu"></i>
              </span>
                    <span class="sidebar-nav-name">
                Update Source
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Update Type -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/update_type/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="maximize-2"></i>
              </span>
                    <span class="sidebar-nav-name">
                Update Type
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Users -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/users/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="user"></i>
              </span>
                    <span class="sidebar-nav-name">
                Users
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Sub Process -->
            <li class="sidebar-nav-item">
                <a href="/dashboard/sub_process/" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="users"></i>
              </span>
                    <span class="sidebar-nav-name">
                Sub Process
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Divider Start-->
            <li class="sidebar-nav-item">
                <div class="dropdown-divider ml-5 mr-5 mt-2 mb-2"></div>
            </li>


            <!-- Divider End-->
            {% endif %}

            {% if user.email == 'superuser' %}
            <!-- Add Accounts -->
            <li class="sidebar-nav-item">
                <a href="{% url 'listAccount' %}" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="package"></i>
              </span>
                    <span class="sidebar-nav-name">
                Add Accounts
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Add Projects -->
            <li class="sidebar-nav-item">
                <a href="{% url 'listProject' %}" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="layers"></i>
              </span>
                    <span class="sidebar-nav-name">
                Add Projects
              </span>
                    <span class="sidebar-nav-end"></span>
                </a>
            </li>

            <!-- Create Admin -->
            <li class="sidebar-nav-item">
                <a href="{% url 'listAdmin' %}" class="sidebar-nav-link">
              <span class="sidebar-nav-icon">
                <i data-feather="award"></i>
              </span>
                    <span class="sidebar-nav-name">
                Create Admin
              </span>
                    <span class="sidebar-nav-end">
              </span>
                </a>
            </li>

            <!-- Divider Start-->
            <li class="sidebar-nav-item">
                <div class="dropdown-divider ml-5 mr-5 mt-2 mb-5"></div>
            </li>
            <!-- Divider End-->
            {% endif %}

        </ul>
    </div>
    <!-- Sidebar End -->

    <!-- Main-content-aside -->
    <div class="main-content">

        <div class="main-main-content">
            <div id="loading">
                <img src="{% static 'images/4105180.gif' %}" class="ajax-loader"/>
            </div>

            <div class="container-fluid">

                {% if user.email == 'poc' or user.email == 'superuser' %}

                    <div class="p-2 mt-2" id="update_section" style="background-color: #E8F5E9; border-radius: .25rem">
                        <div class="row mt-1">
                            <div class="col-lg-3 mt-1">
                                <h6 style="font-size:11px; font-weight:600">Knowledge Test :</h6>
                                <select name="select" class="form-control js-choice" id="conquest_id">
                                    <option value="1">-- Select Knowledge Test --</option>
                                    {% for kc in conquest_id %}
                                    <option value="{{ forloop.counter }}">{{ kc.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="p-2 mt-2" style="background-color: #FFF3E0; border-radius: .25rem">
                        <div class="card mb-grid">
                            <div class="card-header" style="background-color:#ffffff; color:#000000">
                                <div style="background-color: #FFF3E0; border-radius: .25rem">
                                    <div class="row ml-1 mr-1 pt-2 pb-1">
                                        <div class="col-lg-3">
                                            <div class="form-group" style="color: #000000">
                                                <h6 style="font-size:11px; font-weight:600">Question Type :</h6>
                                                <select name="select" class="form-control js-choice" id="question_type"
                                                        onchange="showDiv(this)">
                                                    <option value="1">-- Select Question Type --</option>
                                                    <option value="2">True or False</option>
                                                    <option value="3">MCQs</option>
                                                    <option value="4">MAQs</option>
                                                    <option value="5">Subjective</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <h6 style="font-size:11px; font-weight:600">Question Marks :</h6>
                                            <div class="form-group" style="color: #000000">
                                                <input type="text" maxlength="1"
                                                       oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                                                       class="form-control" id="marks"
                                                       aria-describedby="emailHelp"
                                                       placeholder="Marks" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <h6 style="font-size:11px; font-weight:600">Media File :</h6>
                                            <div class="form-group" style="color: #000000">
                                                <select name="select" class="form-control js-choice" id="media_type"
                                                        onchange="showUpload(this)">
                                                    <option value="1">No Media</option>
                                                    <option value="2">Video</option>
                                                    <option value="3">Audio</option>
                                                    <option value="4">Document</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 pt-4">
                                            <input type="file" onchange="upload_file(this)" id="upload_video_file"
                                                   style="color:#000000; font-size:16px; font-weight:400; display:none"
                                                   accept=".mp4,.avi">
                                            <input type="file" onchange="upload_file(this)" id="upload_audio_file"
                                                   style="color:#000000; font-size:16px; font-weight:400; display:none"
                                                   accept=".mp3,.wav">
                                            <input type="file" onchange="upload_file(this)" id="upload_docs_file"
                                                   style="color:#000000; font-size:16px; font-weight:400; display:none"
                                                   accept=".xls,.xlsx,.docx,.doc,.pdf,.pptx">
                                        </div>
                                    </div>
                                    <h5 class="ml-3 mr-3 pb-2" style="font-size:12px; font-weight:400" hidden></h5>
                                </div>
                                <form>
                                    <div class="row mb-2 mt-1">
                                        <div class="col-lg-12">
                                            {{ question_editor.media }}
                                            {{ question_editor.as_p }}
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <div class="card mb-grid text-center">
                                <div class="card-body m-2" style="background-color: #FFF3E0; border-radius: .25rem">
                                    <div class="row" id="qtype_tf">

                                        <div class="row mt-1">
                                            <div class="col-lg-1 mt-1" align="right">
                                                <input class="option_tf" type="radio">
                                            </div>
                                            <div class="col-lg-3" align="left">
                                                <input type="email" class="form-control" id="option_tf_true"
                                                       placeholder="True" autocomplete="off">
                                            </div>
                                        </div>

                                        <div class="row mt-1">
                                            <div class="col-lg-1 mt-1" align="right">
                                                <input class="option_tf" type="radio">
                                            </div>
                                            <div class="col-lg-3" align="left">
                                                <input type="email" class="form-control" id="option_tf_false"
                                                       placeholder="False" autocomplete="off">
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row" id="qtype_mcq">
                                        <div id="mcq_options">
                                            <div class="col-lg-12" align="right">
                                                <button type="button" class="btn btn-sm btn-success"
                                                        id="add_ops_mcq">Add Option
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row" id="qtype_maq">
                                        <div id="maq_options">
                                            <div class="col-lg-12" align="right">
                                                <button type="button" class="btn btn-sm btn-success"
                                                        id="add_ops_maq">Add Option
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row" id="qtype_subjective" style="display:none">
                                        <form>
                                            <div class="form-group" align="left">
                                                <label for="subjective_answer" style="font-size:12px; font-weight:600">Answer</label>
                                                <textarea class="form-control" id="subjective_answer" maxlength="750"
                                                          rows="4"></textarea>
                                                <label id="count" style="font-size:12px"></label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-5">
                            <div class="col-lg-12 mr-2" align="center">
                                <button class="btn btn-labeled-center btn-primary" id="save_question">
                                      <span class="btn-text pl-5 pr-5">
                                        Save Question
                                      </span>
                                </button>
                            </div>
                        </div>
                    </div>

                {% else %}

                    <div class="row mb-2 mt-1">

                    <div class="col">
                        <h6 style="font-weight:600">**YOU ARE NOT AUTHORIZED TO ACCESS THIS WEB PAGE AS PER THE DOT
                            COMPLIANCE**</h6>
                    </div>

                </div>

                {% endif %}

            </div>
        </div>
    </div>
</div>

<!-- If you prefer jQuery these are the required scripts -->
<script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/vendor.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script src="{% static 'js/timer.js' %}"></script>

<script>

    var choices = new Choices('.js-choice');

    $("#subjective_answer").keyup(function(){
        $("#count").text("(" + (750 - $(this).val().length) + " characters remaining)");
    });

    function showDiv(element) {
        document.getElementById("qtype_tf").style.display = element.value == 2 ? 'block' : 'none';
        document.getElementById("qtype_mcq").style.display = element.value == 3 ? 'block' : 'none';
        document.getElementById("qtype_maq").style.display = element.value == 4 ? 'block' : 'none';
        document.getElementById("qtype_subjective").style.display = element.value == 5 ? 'block' : 'none';
    }

    function showUpload(element) {
        element.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.querySelectorAll('h5')[0].innerText = "";
        document.getElementById("upload_video_file").style.display = element.value == 2 ? 'block' : 'none';
        document.getElementById("upload_audio_file").style.display = element.value == 3 ? 'block' : 'none';
        document.getElementById("upload_docs_file").style.display = element.value == 4 ? 'block' : 'none';
    }

    $(".option_tf").change(function () {
        $(".option_tf").prop('checked', false);
        $(this).prop('checked', true);
    });

    $(".option_tf").on('click', function () {
        $(".option_tf").prop('checked', false);
        $(this).prop('checked', true);
    });

    $('#add_ops_mcq').on('click', function (e) {
    e.preventDefault();

    var div1 = document.createElement('div');
    div1.setAttribute("class", "row mt-1");
    div1.setAttribute("id", "mcq_option");

    var div2 = document.createElement('div');
    div1.appendChild(div2);
    div2.setAttribute("class", "col-lg-1 mt-1");
    div2.setAttribute("align", "right");
    var input_div2 = document.createElement('input');

    function check_event_listener(e) {
        $(".option_mcq").prop('checked', false);
        $(this).prop('checked', true);
    }

    div2.appendChild(input_div2);
    input_div2.setAttribute("class", "option_mcq");
    input_div2.setAttribute("type", "radio");
    input_div2.addEventListener("click", check_event_listener);

    var div3 = document.createElement('div');
    div1.appendChild(div3);
    div3.setAttribute("class", "col-lg-3");
    div3.setAttribute("align", "left");
    var input_div3 = document.createElement('input');
    div3.appendChild(input_div3);
    input_div3.setAttribute("class", "form-control");
    input_div3.setAttribute("itemtype", "option_mcq_text");
    input_div3.setAttribute("placeholder", "Enter Option");

    var div4 = document.createElement('div');
    div1.appendChild(div4);
    div4.setAttribute("class", "col-lg-1");
    var button_div4 = document.createElement('button');
    div4.appendChild(button_div4);
    button_div4.setAttribute("type", "button");
    button_div4.setAttribute("class", "btn btn-sm btn-danger");

    function Remove_This(e) {
        var element = e.target;
        e.preventDefault();
        element.removeEventListener('click', Remove_This);
        $(element.parentElement.parentElement).remove();
    }

    button_div4.addEventListener('click', Remove_This);
    button_div4.innerHTML = "Delete";

    document.getElementById('mcq_options').appendChild(div1);

});

    $('#add_ops_maq').on('click', function (e) {
    e.preventDefault();

    var div1 = document.createElement('div');
    div1.setAttribute("class", "row mt-1");
    div1.setAttribute("id", "maq_option");

    var div2 = document.createElement('div');
    div1.appendChild(div2);
    div2.setAttribute("class", "col-lg-1 mt-1");
    div2.setAttribute("align", "right");
    var input_div2 = document.createElement('input');
    div2.appendChild(input_div2);
    input_div2.setAttribute("class", "option_maq");
    input_div2.setAttribute("type", "checkbox");

    var div3 = document.createElement('div');
    div1.appendChild(div3);
    div3.setAttribute("class", "col-lg-3");
    div3.setAttribute("align", "left");
    var input_div3 = document.createElement('input');
    div3.appendChild(input_div3);
    input_div3.setAttribute("class", "form-control");
    input_div3.setAttribute("itemtype", "option_maq_text");
    input_div3.setAttribute("placeholder", "Enter Option");

    var div4 = document.createElement('div');
    div1.appendChild(div4);
    div4.setAttribute("class", "col-lg-1");
    var button_div4 = document.createElement('button');
    div4.appendChild(button_div4);
    button_div4.setAttribute("type", "button");
    button_div4.setAttribute("class", "btn btn-sm btn-danger");

    function Remove_This(e) {
        var element = e.target;
        e.preventDefault();
        element.removeEventListener('click', Remove_This);
        $(element.parentElement.parentElement).remove();
    }

    button_div4.addEventListener('click', Remove_This);
    button_div4.innerHTML = "Delete";

    document.getElementById('maq_options').appendChild(div1);

});

     $('#save_question').on('click', function (e) {
        e.preventDefault();
        question_type = $("#question_type option:selected").text();

        questions = [];
        question = document.querySelectorAll("div#cke_id_question iframe")[0].contentWindow.document.querySelector('body').innerHTML;
        
        kc_id = $("#conquest_id option:selected").text();
        marks = $("#marks").val();
        media_type = $("#media_type option:selected").text();

        media_url = "";
        if(media_type != "No Media") {
                media_url = document.querySelectorAll(".card-header")[0].querySelectorAll("h5")[0].innerText;
            }
        else {
                media_url = "";
            }

          if (kc_id == "-- Select Knowledge Test --") {
            alert("Please Select Knowledge Test");
          }else if (!marks) {
            alert("Please enter marks for this question");
          }else if (question == "<br>") {
            alert("Question Body : cannot be left blank");
          }else if (media_type != "No Media" && media_url == ""){
            alert("Please Select the Media File to Upload");
          }
          else {
            check = 0;
            question_options = [];
            question_answer = [];
            if(question_type == "Subjective")
            {
                answer = $('#subjective_answer').val();
                if(answer)
                {
                    question_options.push("answer");
                    question_answer.push(answer);
                }
                else
                {
                    alert('Please provide answer of this question');
                }
            }
            else if (question_type == "MCQs") {
                var op_count = document.querySelectorAll("input[itemtype = option_mcq_text]").length;
                if (op_count < 3) {
                    alert('Please provide atleast 3 options in MCQs');
                    check = 1;
                    return;
                } else {
                    for (var c = 0; c < op_count; c++) {
                        option = document.querySelectorAll("input[itemtype = option_mcq_text]")[c].value
                        if (option == "") {
                            alert('Added Options Cannot be left blank');
                            check = 1;
                            return;
                        } else {
                            question_options.push(option);

                            if (document.querySelectorAll("input[class = option_mcq]")[c].checked) {
                                question_answer.push(1);
                            } else {
                                question_answer.push(0);
                            }
                        }
                    }
                }
            } else if (question_type == "MAQs") {
                var op_count = document.querySelectorAll("input[itemtype = option_maq_text]").length;
                if (op_count < 2) {
                    alert('Please provide atleast 2 options in MAQs');
                    check = 1;
                    return;
                } else {
                    for (var c = 0; c < op_count; c++) {
                        option = document.querySelectorAll("input[itemtype = option_maq_text]")[c].value;
                        if (option == "") {
                            alert('Added Options Cannot be left blank');
                            check = 1;
                            return;
                        } else {
                            question_options.push(option);

                            if (document.querySelectorAll("input[class = option_maq]")[c].checked) {
                                question_answer.push(1);
                            } else {
                                question_answer.push(0);
                            }
                        }
                    }
                }
            } else if (question_type == "True or False") {
                $true = document.querySelector('#option_tf_true').value;
                $false = document.querySelector('#option_tf_false').value;

                if ($true == "") {
                    alert('Added Options Cannot be left blank');
                    check = 1;
                    return;
                } else if ($false == "") {
                    alert('Added Options Cannot be left blank');
                    check = 1;
                    return;
                } else {
                    question_options.push($true);
                    question_options.push($false);

                    if (document.querySelectorAll("input[class = option_tf]")[0].checked) {
                        question_answer.push(1);
                    } else {
                        question_answer.push(0);
                    }

                    if (document.querySelectorAll("input[class = option_tf]")[1].checked) {
                        question_answer.push(1);
                    } else {
                        question_answer.push(0);
                    }
                }
            } else {
                alert('Please Select the Question Type');
                check = 1;
                return;
            }

            no_check_count = 0;
            for (var qa_val = 0; qa_val < question_answer.length; qa_val++) {

                if (question_answer[qa_val] == 0) {
                    no_check_count++;
                }
            }
            if (no_check_count == question_answer.length) {
                alert('Please provide atleast one correct answer in each question');
                check = 1;
                return;
            } else {
                var object = {};
                object['question']              = question;
                object['question_type']         = question_type;
                object['question_options']      = question_options;
                object['question_answer']       = question_answer;
                object['question_marks']        = marks;
                object['question_media_type']   = media_type;
                object['question_media_url']    = media_url;

                questions.push(object);
            }

            if (check == 0) {

                $('#loading').show();
                $.ajax({

                    type: "POST",
                    url: "{% url 'save_conquest_question' %}",
                    data: {
                        conquest_id: kc_id,
                        questions: JSON.stringify(questions),
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data) {
                        $('#loading').hide();
                        alert('Question Saved with Knowledge Test Successfully');
                        window.location = "";
                    }
                });
            }
            }
    });

    function hideLoader() {
        $('#loading').hide();
    }

    $(window).ready(hideLoader);

    function upload_file(e) {
        $('#loading').show();
        var formData = new FormData();
        formData.append('user_file', e.files[0]);
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
        $.ajax({
            url: "{% url 'upload_media_file' %}",
            type: 'post',
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            success: function(data){
              $('#loading').hide();
              if (data['code'] == 1)
              {
                e.parentElement.parentElement.parentElement.querySelectorAll('h5')[0].innerText = data['uploaded_media_url'];
                notify(data['message'], 'success')
              }
              else {
                $(e).val('');
                notify(data['message'], 'danger');
              }
            }
        });
    }

    const notifications = new window.notifications({
        notificationSound: '{% static 'media/notification.mp3' %}',
        volume: 0.5
    });

    function notify(message, style_type) {
        notifications.fire(message, {
            autoHide: true,
            playSound: true,
            duration: 5000,
            style: style_type,
        });
    }

</script>

</body>
</html>